<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Question Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>    
    <link href="https://www.brainjelli.com/landing.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.2/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chart.js/4.4.0/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-chartjs-2@5.2.0/dist/index.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-simple-maps@3.0.0/dist/index.umd.min.js"></script>
</head>
<body class="bg-gray-100">
    <header> 
        <div class="header-container"> 
            <img src="BrainJelli-header.png" class="logo"> 
            <div class="button-group">
                <button class="theme-toggle" aria-label="Toggle dark mode">
                    <span class="toggle-icon">☀️</span>
                </button>
                <button class="login-button">Login</button> 
            </div>
        </div> 
    </header>

    <body class="bg-gray-100">
        <div id="root" class="container mx-auto p-6">
            <p>Loading dashboard...</p>
        </div>
    
        <script type="text/babel">
            const { useState, useEffect } = React;
            const { Line } = window.ReactChartJS;
            const { ComposableMap, Geographies, Geography } = window.ReactSimpleMaps;
    
            // Register Chart.js components
            if (window.Chart) {
                Chart.register(
                    Chart.LineElement,
                    Chart.PointElement,
                    Chart.LinearScale,
                    Chart.CategoryScale,
                    Chart.Title,
                    Chart.Tooltip,
                    Chart.Legend
                );
            }
    
            // Sample answer data (abridged for brevity; full data can be restored if needed)
            const answerData = {
                "inference": {
                    easy: { "What does the passage suggest about Emma’s feelings?": { correct: 120, incorrect: 30 } },
                    medium: { "What does the passage suggest about Daniel's attitude?": { correct: 100, incorrect: 50 } },
                    hard: {
                        "The passage implies that Dr. Thorne's reaction is:": { correct: 80, incorrect: 70 },
                        "It can be inferred from the cartographer's words:": { correct: 90, incorrect: 60 }
                    }
                },
                "command-of-evidence": {
                    easy: { "Which evidence supports the nutritionist’s claim?": { correct: 140, incorrect: 10 } },
                    medium: { "Which choice supports Liam’s uncertainty?": { correct: 110, incorrect: 40 } },
                    hard: { "Which evidence supports Dr. Voss’s claim?": { correct: 90, incorrect: 60 } }
                },
                "central-ideas": {
                    easy: { "What is the central idea?": { correct: 150, incorrect: 0 } },
                    medium: { "Which evidence supports Dr. Evelyn’s doubts?": { correct: 110, incorrect: 40 } },
                    hard: { "What is the central idea?": { correct: 95, incorrect: 55 } }
                }
                // Add other categories as needed
            };
    
            // Estimated state data
            const stateData = [
                { state: 'California', users: 840, percentage: 12 },
                { state: 'Texas', users: 630, percentage: 9 },
                { state: 'Florida', users: 490, percentage: 7 },
                { state: 'New York', users: 420, percentage: 6 },
                { state: 'Pennsylvania', users: 280, percentage: 4 },
                { state: 'Others', users: 3340, percentage: 52 }
            ];
    
            // Error Boundary Component
            class ErrorBoundary extends React.Component {
                state = { hasError: false, error: null };
                static getDerivedStateFromError(error) {
                    return { hasError: true, error };
                }
                render() {
                    if (this.state.hasError) {
                        return (
                            <div className="bg-red-100 p-4 rounded">
                                <h2 className="text-xl font-bold text-red-800">Error Loading Dashboard</h2>
                                <p className="text-red-600">{this.state.error?.message || 'Unknown error'}</p>
                            </div>
                        );
                    }
                    return this.props.children;
                }
            }
    
            // Line Graph Component
            const LineGraph = () => {
                const categories = Object.keys(answerData);
                const interactions = categories.map(category => {
                    const difficulties = answerData[category];
                    return Object.values(difficulties).reduce((sum, diff) => 
                        sum + Object.values(diff).reduce((s, q) => s + q.correct + q.incorrect, 0), 0);
                });
    
                const data = {
                    labels: categories.map(c => c.replace(/-/g, ' ')),
                    datasets: [{
                        label: 'Total User Interactions',
                        data: interactions,
                        borderColor: 'rgba(75, 192, 192, 1)',
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        fill: false,
                        tension: 0.1
                    }]
                };
    
                const options = {
                    responsive: true,
                    plugins: {
                        legend: { position: 'top' },
                        title: { display: true, text: 'User Interactions by Category' }
                    },
                    scales: {
                        y: { beginAtZero: true, title: { display: true, text: 'Number of Interactions' } },
                        x: { title: { display: true, text: 'Category' } }
                    }
                };
    
                return (
                    <div className="bg-white rounded-lg shadow p-6 mb-6">
                        <h2 className="text-xl font-bold mb-4">User Engagement Trend</h2>
                        {window.Chart ? <Line data={data} options={options} /> : <p>Chart.js failed to load</p>}
                    </div>
                );
            };
    
            // State Map Component
            const StateMap = () => {
                const geoUrl = "https://cdn.jsdelivr.net/npm/us-atlas@3/states-10m.json";
                const userData = {
                    "California": 840,
                    "Texas": 630,
                    "Florida": 490,
                    "New York": 420,
                    "Pennsylvania": 280
                };
    
                return (
                    <div className="bg-white rounded-lg shadow p-6 mb-6">
                        <h2 className="text-xl font-bold mb-4">User Distribution by State</h2>
                        <ComposableMap projection="geoAlbersUsa" width={600} height={400}>
                            <Geographies geography={geoUrl}>
                                {({ geographies }) =>
                                    geographies.map(geo => {
                                        const state = geo.properties.name;
                                        const users = userData[state] || 0;
                                        const fillColor = users > 800 ? '#800000' :
                                                         users > 600 ? '#B22222' :
                                                         users > 400 ? '#CD5C5C' :
                                                         users > 200 ? '#F08080' : '#FFE4E1';
                                        return (
                                            <Geography
                                                key={geo.rsmKey}
                                                geography={geo}
                                                fill={fillColor}
                                                stroke="#FFF"
                                            />
                                        );
                                    })
                                }
                            </Geographies>
                        </ComposableMap>
                    </div>
                );
            };
    
            // State Breakdown Table
            const StateTable = () => {
                return (
                    <div className="bg-white rounded-lg shadow p-6 mb-6">
                        <h2 className="text-xl font-bold mb-4">User Breakdown by State</h2>
                        <table className="w-full text-left">
                            <thead>
                                <tr className="bg-gray-200">
                                    <th className="p-2">State</th>
                                    <th className="p-2">Estimated Users</th>
                                    <th className="p-2">Percentage</th>
                                </tr>
                            </thead>
                            <tbody>
                                {stateData.map(({ state, users, percentage }) => (
                                    <tr key={state} className="border-b">
                                        <td className="p-2">{state}</td>
                                        <td className="p-2">{users}</td>
                                        <td className="p-2">{percentage}%</td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                );
            };
    
            // Category View
            const CategoryView = ({ setView, setSelectedCategory }) => {
                const categories = Object.keys(answerData);
    
                const handleCategoryClick = (category) => {
                    setSelectedCategory(category);
                    setView('difficulty');
                };
    
                return (
                    <div className="bg-white rounded-lg shadow p-6">
                        <h1 className="text-2xl font-bold mb-4">Category Overview</h1>
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            {categories.map(category => {
                                const totalCorrect = Object.values(answerData[category]).reduce((sum, diff) => 
                                    sum + Object.values(diff).reduce((s, q) => s + q.correct, 0), 0);
                                const totalIncorrect = Object.values(answerData[category]).reduce((sum, diff) => 
                                    sum + Object.values(diff).reduce((s, q) => s + q.incorrect, 0), 0);
                                return (
                                    <div 
                                        key={category} 
                                        className="p-4 bg-blue-50 rounded-lg cursor-pointer hover:bg-blue-100"
                                        onClick={() => handleCategoryClick(category)}
                                    >
                                        <h2 className="text-lg font-semibold capitalize">{category.replace(/-/g, ' ')}</h2>
                                        <p>Correct Answers: {totalCorrect}</p>
                                        <p>Incorrect Answers: {totalIncorrect}</p>
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                );
            };
    
            // Difficulty View
            const DifficultyView = ({ selectedCategory, setView, setSelectedDifficulty }) => {
                const difficulties = Object.keys(answerData[selectedCategory]);
    
                const handleDifficultyClick = (difficulty) => {
                    setSelectedDifficulty(difficulty);
                    setView('question');
                };
    
                return (
                    <div className="bg-white rounded-lg shadow p-6">
                        <h1 className="text-2xl font-bold mb-4">Category: {selectedCategory.replace(/-/g, ' ')}</h1>
                        <button 
                            className="mb-4 text-blue-600 hover:underline"
                            onClick={() => setView('category')}
                        >
                            Back to Categories
                        </button>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            {difficulties.map(difficulty => {
                                const totalCorrect = Object.values(answerData[selectedCategory][difficulty]).reduce((sum, q) => sum + q.correct, 0);
                                const totalIncorrect = Object.values(answerData[selectedCategory][difficulty]).reduce((sum, q) => sum + q.incorrect, 0);
                                return (
                                    <div 
                                        key={difficulty} 
                                        className="p-4 bg-green-50 rounded-lg cursor-pointer hover:bg-green-100"
                                        onClick={() => handleDifficultyClick(difficulty)}
                                    >
                                        <h2 className="text-lg font-semibold capitalize">{difficulty}</h2>
                                        <p>Correct Answers: {totalCorrect}</p>
                                        <p>Incorrect Answers: {totalIncorrect}</p>
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                );
            };
    
            // Question View
            const QuestionView = ({ selectedCategory, selectedDifficulty, setView }) => {
                const questions = answerData[selectedCategory][selectedDifficulty];
    
                return (
                    <div className="bg-white rounded-lg shadow p-6">
                        <h1 className="text-2xl font-bold mb-4">Category: {selectedCategory.replace(/-/g, ' ')} ({selectedDifficulty})</h1>
                        <button 
                            className="mb-4 text-blue-600 hover:underline"
                            onClick={() => setView('difficulty')}
                        >
                            Back to Difficulties
                        </button>
                        <div className="space-y-4">
                            {Object.entries(questions).map(([question, data]) => (
                                <div key={question} className="p-4 bg-gray-50 rounded-lg">
                                    <h2 className="text-lg font-semibold">{question}</h2>
                                    <p>Correct Answers: {data.correct}</p>
                                    <p>Incorrect Answers: {data.incorrect}</p>
                                </div>
                            ))}
                        </div>
                    </div>
                );
            };
    
            // Main App Component
            const App = () => {
                const [view, setView] = useState('overview');
                const [selectedCategory, setSelectedCategory] = useState(null);
                const [selectedDifficulty, setSelectedDifficulty] = useState(null);
    
                return (
                    <ErrorBoundary>
                        <div>
                            <nav className="bg-blue-600 text-white p-4 mb-6">
                                <button 
                                    className="mr-4 hover:underline" 
                                    onClick={() => setView('overview')}
                                >
                                    Overview
                                </button>
                                <button 
                                    className="mr-4 hover:underline" 
                                    onClick={() => setView('category')}
                                >
                                    Categories
                                </button>
                            </nav>
                            {view === 'overview' && (
                                <div>
                                    <LineGraph />
                                    <StateMap />
                                    <StateTable />
                                </div>
                            )}
                            {view === 'category' && <CategoryView setView={setView} setSelectedCategory={setSelectedCategory} />}
                            {view === 'difficulty' && (
                                <DifficultyView 
                                    selectedCategory={selectedCategory} 
                                    setView={setView} 
                                    setSelectedDifficulty={setSelectedDifficulty} 
                                />
                            )}
                            {view === 'question' && (
                                <QuestionView 
                                    selectedCategory={selectedCategory} 
                                    selectedDifficulty={selectedDifficulty} 
                                    setView={setView} 
                                />
                            )}
                        </div>
                    </ErrorBoundary>
                );
            };
    
            // Render with error handling
            try {
                const root = ReactDOM.createRoot(document.getElementById('root'));
                root.render(<App />);
            } catch (e) {
                document.getElementById('root').innerHTML = `
                    <div class="bg-red-100 p-4 rounded">
                        <h2 class="text-xl font-bold text-red-800">Failed to Render Dashboard</h2>
                        <p class="text-red-600">${e.message}</p>
                    </div>
                `;
            }
        </script>

    <script src="theme-toggle.js"></script>
</body>
</html>